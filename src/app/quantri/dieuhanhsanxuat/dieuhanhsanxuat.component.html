<!-- <p-chart type="bar" [data]=monthlyConfig></p-chart> -->
<div class="p-d-flex p-ai-center p-jc-between">
    <div class="p-d-flex flex-column flex-lg-row p-pl-3">
        <div class="p-mr-2">
            <p-calendar dateFormat="dd/mm/yy" inputStyleClass="p-inputtext-sm" [showIcon]="true"
                [(ngModel)]="filter._tuNgay" inputId="icon" placeholder="Từ ngày" (onSelect)="ChangeOptBieuDo()">
            </p-calendar>
        </div>
        <div class="p-mr-2">
            <p-calendar dateFormat="dd/mm/yy" inputStyleClass="p-inputtext-sm" [showIcon]="true"
                [(ngModel)]="filter._denNgay" inputId="icon" placeholder="Đến ngày" (onSelect)="ChangeOptBieuDo()">
            </p-calendar>
        </div>
    </div>
</div>
<div class="p-grid">
    <!-- style="align-self: stretch;" -->
    <div class="p-col-12 p-xl-8 p-lg-8 p-p-3">
        <div class="chart text-left">
            <div class="p-d-flex flex-column flex-lg-row p-jc-between">
                <div>
                    <h5>
                        {{filterNhuCau.Kho ==='8cb622a8-b2c5-4232-a9f1-7fdebb40e3cb'?'Sản lượng kế hoạch và thực
                        hiện':'Nhu cầu sử dụng bông'}}
                    </h5>
                </div>
                <div class="p-d-flex flex-column flex-lg-row">
                    <div class="p-mr-2">
                        <p-dropdown [filter]="true" [options]="listKho" placeholder="Chọn kho"
                            styleClass="p-inputtext-sm" [(ngModel)]="filter.IddmKho"
                            (onChange)="getMatHangNhuCau($event.value)">
                        </p-dropdown>
                    </div>
                    <div class="p-mr-2">
                        <p-dropdown [filter]="true" [options]="listLoaiBong" placeholder="Chọn loại bông"
                            styleClass="p-inputtext-sm" [(ngModel)]="filter.IddmLoaiBong"
                            (onChange)="ChangeOptBieuDo()">
                        </p-dropdown>
                    </div>
                    <!-- <div style="display:table;height:100%">
                        <a style="display: table-cell; vertical-align: middle;" href="javascript:void(0)">Cân đối
                            tồn</a>
                    </div> -->
                </div>
            </div>
            <p-chart type="line" [data]=dataSet1 [options]="option1"></p-chart>
        </div>
    </div>
    <div class="p-col-12 p-xl-4 p-lg-4 p-p-3">
        <div class="chart text-left" style="display:flex;flex-direction: column;">
            <!-- <h5>{{filterNhuCau.Kho ==='8cb622a8-b2c5-4232-a9f1-7fdebb40e3cb'?'Cơ cấu mặt hàng':'Cơ cấu bông'}}</h5> -->
            <h5>Cơ cấu bông</h5>
            <div style="display: flex;flex-direction: row;flex:1;">
                <div style="width: 30%;
                display: flex;
                justify-content: center;
                align-items: center; height: 100%;">
                    <div>
                        <div style="width: 100%;display: flex;flex-direction: row; vertical-align: middle;align-items: center;margin-bottom: 5px;"
                            *ngFor="let legend of pieLegend">
                            <!-- <span [ngStyle]="{'background-color': legend.Color, width:'10px' , height:'20px'}"></span>
                            <span style="display:flex;flex-direction:column;margin-left: 5px;">
                                <div style="font-size: 12px">
                                    {{legend.Ten}}
                                </div>
                                <div style="font-size: 12px;font-weight: bold;">
                                    {{legend.TyLe|number:'0.2-2'}}%
                                </div>
                            </span> -->
                            <span [ngStyle]="{'background-color': legend.Color, width:'10px' , height:'20px'}"></span>
                            <span style="display:flex;flex-direction:column;margin-left: 5px;">
                                <div style="font-size: 13px">
                                    {{legend.Ten}}
                                </div>
                                <div style="font-size: 12px;font-weight: bold;">
                                    {{legend.TyLe|number:'0.2-2'}}%
                                </div>
                            </span>
                        </div>
                    </div>

                </div>
                <div style="width: 70%; display: flex;
                justify-content: center;
                align-items: center; height: 100%;">
                    <div style="display: inline-block;">
                        <p-chart type="pie" [data]="dataPie" [options]='optionPie'></p-chart>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<div class="p-grid" style="align-self: stretch;">
    <div class="p-col-12 p-p-3">
        <div class="chart text-left" style="display: flex;flex-direction: column;">
            <div class="p-d-flex flex-column flex-lg-row">
                <h5 class="p-mb-0 p-mr-2 p-mt-2">
                    Cân đối tồn
                </h5>
                <div class="p-mr-2">
                    <p-calendar dateFormat="dd/mm/yy" inputStyleClass="p-inputtext-sm" [showIcon]="true"
                        [(ngModel)]="filterNhuCau._tuNgayCanDoiTon" inputId="icon" placeholder="Từ ngày"
                        (onSelect)="ChangeOptCanDoiTon()">
                    </p-calendar>
                </div>
                <div class="p-mr-2">
                    <p-calendar dateFormat="dd/mm/yy" inputStyleClass="p-inputtext-sm" [showIcon]="true"
                        [(ngModel)]="filterNhuCau._denNgayCanDoiTon" inputId="icon" placeholder="Đến ngày"
                        (onSelect)="ChangeOptCanDoiTon()">
                    </p-calendar>
                </div>
                <div class="p-mr-2">
                    <p-dropdown [filter]="true" [options]="listKhoCanDoiTon" placeholder="Chọn kho"
                        styleClass="p-inputtext-sm" [(ngModel)]="filterNhuCau.IddmKho"
                        (onChange)="getMatHangCanDoiTon($event.value)">
                    </p-dropdown>
                </div>
                <div class="p-mr-2">
                    <p-dropdown [filter]="true" [options]="listLoaiBongCanDoiTon" placeholder="Chọn loại bông"
                        styleClass="p-inputtext-sm" [(ngModel)]="filterNhuCau.IddmLoaiBong"
                        (onChange)="ChangeOptCanDoiTon()">
                    </p-dropdown>
                </div>
                <div class="p-mr-2">
                    <a style="display: table-cell; vertical-align: middle;" href="javascript:void(0)"
                        (click)="XuatBaoCaoCanDoiTon()">Xuất báo cáo</a>
                </div>
            </div>
            <div class="pintable-container" style="height: calc( 50vh - 72.25px );width: 100%;" voiPintable
                [pinnedCols]="colsNum">
                <table>
                    <thead>
                        <tr>
                            <!-- <th>Ngày</th> -->
                            <th rowspan="2" class="width-150">Loại bông</th>
                            <th rowspan="2" class="width-150">Lô bông</th>
                            <th rowspan="2" class="width-150">Hợp đồng P/O</th>
                            <th colspan="2">Tồn đầu</th>
                            <th colspan="2">Nhập trong kỳ</th>
                            <th colspan="2">Xuất trong kỳ</th>
                            <th colspan="2">Tồn cuối kỳ</th>
                        </tr>
                        <tr>
                            <th style="display: none;"></th>
                            <th style="display: none;"></th>
                            <th style="display: none;"></th>
                            <th class="width-150">Số kiện</th>
                            <th class="width-150">KL</th>
                            <th class="width-150">Số kiện</th>
                            <th class="width-150">KL</th>
                            <th class="width-150">Số kiện</th>
                            <th class="width-150">KL</th>
                            <th class="width-150">Số kiện</th>
                            <th class="width-150">KL</th>
                        </tr>
                        <tr>
                            <td class="width-150 bg-white">Tổng</td>
                            <td class="width-150 bg-white"></td>
                            <td class="width-150 bg-white"></td>
                            <td class="text-right width-150">{{Tong.DauSoKien|number:'0.0-0' }}</td>
                            <td class="text-right width-150">{{Tong.DauSoCan|number:'0.2-2' }}</td>
                            <td class="text-right width-150">{{Tong.NhapSoKien|number:'0.0-0' }}</td>
                            <td class="text-right width-150">{{Tong.NhapSoCan|number:'0.2-2' }}</td>
                            <td class="text-right width-150">{{Tong.XuatSoKien|number:'0.0-0' }}</td>
                            <td class="text-right width-150">{{Tong.XuatSoCan|number:'0.2-2' }}</td>
                            <td class="text-right width-150">{{Tong.CuoiSoKien|number:'0.0-0' }}</td>
                            <td class="text-right width-150">{{Tong.CuoiSoCan|number:'0.2-2' }}</td>
                        </tr>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let item of listItem">
                            <tr [ngStyle]="{'font-weight':item.TendmLoaiBong !== 'TỔNG'?'normal':'bold'}">
                                <td class="width-150 bg-white">{{item.TendmLoaiBong}}</td>
                                <td class="width-150 bg-white">{{item.TenLoBong}}</td>
                                <td class="width-150 bg-white">{{item.SoHopDong}}</td>
                                <td class="text-right width-150">{{item.DauSoKien|number:'0.0-0' }}</td>
                                <td class="text-right width-150">{{item.DauSoCan|number:'0.2-2' }}</td>
                                <td class="text-right width-150">{{item.NhapSoKien|number:'0.0-0' }}</td>
                                <td class="text-right width-150">
                                    <a href="javascript:void(0)" *ngIf="item.TendmLoaiBong!=='TỔNG'"
                                        (click)="callDataXuatNhap('Nhap', item)"> {{item.NhapSoCan|number:'0.2-2' }}</a>
                                    <ng-container *ngIf="item.TendmLoaiBong === 'TỔNG'">
                                        {{item.NhapSoCan|number:'0.2-2' }}
                                    </ng-container>
                                </td>
                                <td class="text-right width-150">{{item.XuatSoKien|number:'0.0-0' }}</td>
                                <td class="text-right width-150">
                                    <a href="javascript:void(0)" *ngIf="item.TendmLoaiBong!=='TỔNG'"
                                        (click)="callDataXuatNhap('Xuat', item)">{{item.XuatSoCan|number:'0.2-2'}}</a>
                                    <ng-container *ngIf="item.TendmLoaiBong === 'TỔNG'">
                                        {{item.XuatSoCan|number:'0.2-2' }}
                                    </ng-container>
                                </td>
                                <td class="text-right width-150">{{item.CuoiSoKien|number:'0.0-0' }}</td>
                                <td class="text-right width-150">{{item.CuoiSoCan|number:'0.2-2' }}</td>
                            </tr>
                        </ng-container>
                    </tbody>
                </table>
            </div>
            <!-- <p-table [value]="listItem" [frozenValue]="Tong"
                styleClass="p-datatable-sm wrap-text p-datatable-striped p-datatable-gridlines minimize-font"
                [scrollable]="true" scrollHeight="260px">
                <ng-template pTemplate="colgroup">
                    <colgroup>
                        <col style="width: 100px;">
                        <col style="width: 100px;">
                        <col style="width: 100px;">
                        <col style="width: 100px;">
                        <col style="width: 100px;">
                        <col style="width: 100px;">
                        <col style="width: 100px;">
                        <col style="width: 100px;">
                        <col style="width: 100px;">
                        <col style="width: 100px;">
                        <col style="width: 100px;">
                    </colgroup>
                </ng-template>
                <ng-template pTemplate="header">
                    <tr>
                        <th rowspan="2">Loại bông</th>
                        <th rowspan="2">Lô bông</th>
                        <th rowspan="2">Hợp đồng P/O</th>
                        <th colspan="2">Tồn đầu</th>
                        <th colspan="2">Nhập trong kỳ</th>
                        <th colspan="2">Xuất trong kỳ</th>
                        <th colspan="2">Tồn cuối kỳ</th>
                    </tr>
                    <tr>
                        <th>Số kiện</th>
                        <th>KL</th>
                        <th>Số kiện</th>
                        <th>KL</th>
                        <th>Số kiện</th>
                        <th>KL</th>
                        <th>Số kiện</th>
                        <th>KL</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-item let-i="rowIndex">
                    <tr [ngClass]="{'p-text-bold': item.TendmLoaiBong=='TỔNG'}">
                        <td>{{item.TendmLoaiBong}}</td>
                        <td>{{item.TenLoBong}}</td>
                        <td>{{item.SoHopDong}}</td>
                        <td class="text-right">{{item.DauSoKien|number:'0.0-0' }}</td>
                        <td class="text-right">{{item.DauSoCan|number:'0.2-2' }}</td>
                        <td class="text-right">{{item.NhapSoKien|number:'0.0-0' }}</td>
                        <td class="text-right">
                            <a href="javascript:void(0)" *ngIf="item.TendmLoaiSoi!==null"
                                (click)="callDataXuatNhap('Nhap', item)"> {{item.NhapSoCan|number:'0.2-2' }}</a>
                        </td>
                        <td class="text-right">{{item.XuatSoKien|number:'0.0-0' }}</td>
                        <td class="text-right">
                            <a href="javascript:void(0)" *ngIf="item.TendmLoaiSoi!==null"
                                (click)="callDataXuatNhap('Xuat', item)">{{item.XuatSoCan|number:'0.2-2'}}</a>

                        </td>
                        <td class="text-right">{{item.CuoiSoKien|number:'0.0-0' }}</td>
                        <td class="text-right">{{item.CuoiSoCan|number:'0.2-2' }}</td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="frozenrows" let-item let-i="rowIndex">
                    <tr [ngClass]="{'p-text-bold': item.TendmLoaiBong=='TỔNG'}">
                        <td>{{item.TendmLoaiBong}}</td>
                        <td>{{item.TenLoBong}}</td>
                        <td>{{item.SoHopDong}}</td>
                        <td class="text-right">{{item.DauSoKien|number:'0.0-0' }}</td>
                        <td class="text-right">{{item.DauSoCan|number:'0.2-2' }}</td>
                        <td class="text-right">{{item.NhapSoKien|number:'0.0-0' }}</td>
                        <td class="text-right">{{item.NhapSoCan|number:'0.2-2' }}</td>
                        <td class="text-right">{{item.XuatSoKien|number:'0.0-0' }}</td>
                        <td class="text-right">{{item.XuatSoCan|number:'0.2-2' }}</td>
                        <td class="text-right">{{item.CuoiSoKien|number:'0.0-0' }}</td>
                        <td class="text-right">{{item.CuoiSoCan|number:'0.2-2' }}</td>
                    </tr>
                </ng-template>
            </p-table> -->
        </div>
    </div>
</div>
<p-dialog [header]="selectedXuatNhap.Ten" [(visible)]="showXuatNhap" [modal]="true" [style]="{width: '85vw'}"
    [baseZIndex]="10000" [draggable]="false" [resizable]="false">
    <p-table [value]="listXuatNhap" styleClass="p-datatable-sm p-datatable-gridlines wrap-text" [scrollable]="true"
        scrollHeight="500px">
        <ng-template pTemplate="colgroup">
            <colgroup>
                <!-- <col style="width:50px"> -->
                <col style="width:50px">
                <col>
                <col>
                <col>
                <col>
            </colgroup>
        </ng-template>
        <ng-template pTemplate="header">
            <tr class="normal">
                <th style="width: 50px !important;">STT</th>
                <th>Số phiếu {{selectedXuatNhap.TenOpt| lowercase}}</th>
                <th>Số phiếu kiểm kê</th>
                <th>Ngày</th>
                <!-- <th>Số quả sợi</th> -->
                <th>Số kiện</th>
                <th>Trọng lượng(kg)</th>
                <th>Tên kho</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item let-i="rowIndex">
            <tr>
                <td class="text-center" style="width: 50px !important;">{{i+1}}</td>
                <td><a href="javascript:void(0)" (click)="navigateXuatNhap(item)">{{item[selectedXuatNhap.field]}}</a>
                </td>
                <td><a href="javascript:void(0)" (click)="navigateKiemKe(item)">{{item.SoPhieuKiemKe}}</a></td>
                <td class="text-center">{{item.Ngay|date:'dd/MM/yyyy'}}</td>
                <td class="text-right">{{item.SoLuong|number:'0.0-0'}}</td>
                <!-- <td class="text-right">{{item.SoKien|number:'0.2-2'}}</td> -->
                <td class="text-right">
                    {{item.TrongLuong|number:'0.2-2'}}
                    <!-- <a [href]="item.herfgiaokehoachsanxuat" target="_blank">{{item.TenGiaoKeHoach}}</a> -->
                </td>
                <td>
                    {{item.TendmKho}}
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="footer">
            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td class="text-right">{{listXuatNhap|SumByKey:'SoLuong'|number:'0.0-0'}}</td>
                <!-- <td class="text-right">{{listXuatNhap|SumByKey:'SoKien'|number:'0.2-2'}}</td> -->
                <td class="text-right">{{listXuatNhap|SumByKey:'TrongLuong'|number:'0.2-2'}}</td>
                <td></td>
            </tr>
        </ng-template>
    </p-table>
</p-dialog>